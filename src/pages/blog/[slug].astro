---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTASection from '../../components/CTASection.astro';
import { blogPosts, getPostBySlug } from '../../data/blogPosts';

export async function getStaticPaths() {
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props;
const slug = post.slug;

// Get related posts from same category
const relatedPosts = blogPosts
  .filter(p => p.category === post.category && p.slug !== post.slug)
  .slice(0, 3);

// Article schema
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.title,
  "description": post.excerpt,
  "image": post.image,
  "author": {
    "@type": "Organization",
    "name": "Search Engine Coach"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Search Engine Coach",
    "url": "https://searchenginecoach.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://searchenginecoach.com/logo.png"
    }
  },
  "datePublished": post.date,
  "dateModified": post.date,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://searchenginecoach.com/blog/${slug}/`
  },
  "keywords": [post.primaryKeyword, ...post.secondaryKeywords].join(', ')
};
---

<BaseLayout
  title={`${post.title} | Search Engine Coach`}
  description={post.excerpt}
  canonicalUrl={`/blog/${slug}/`}
  schema={articleSchema}
>
  <article class="blog-article">
    <div class="container">
      <!-- Article Header -->
      <header class="article-header">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="/">Home</a>
          <span>/</span>
          <a href="/blog/">Blog</a>
          <span>/</span>
          <span>{post.title}</span>
        </nav>
        
        <div class="article-meta-top">
          <span class="article-category">{post.category}</span>
        </div>
        
        <h1>{post.title}</h1>
        
        <div class="article-meta">
          <span class="article-author">{post.author}</span>
          <span class="article-separator">•</span>
          <time datetime={post.date}>
            {new Date(post.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
          </time>
          <span class="article-separator">•</span>
          <span>{post.readTime}</span>
        </div>
      </header>
      
      <!-- Featured Image -->
      <div class="article-image">
        <img src={post.image} alt={post.imageAlt} loading="eager" />
      </div>
      
      <!-- Article Content Grid -->
      <div class="article-grid">
        <div class="article-content prose" set:html={post.content} />
        
        <aside class="article-sidebar">
          <div class="sidebar-sticky">
            <div class="sidebar-cta">
              <h3>Need Help With Your SEO?</h3>
              <p>Get matched with experts who can help your business rank higher.</p>
              <a href="/#lead-form" class="btn btn-primary">Get Free Strategy</a>
            </div>
            
            {relatedPosts.length > 0 && (
              <div class="sidebar-related">
                <h3>Related Articles</h3>
                <ul>
                  {relatedPosts.map(related => (
                    <li><a href={`/blog/${related.slug}/`}>{related.title}</a></li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        </aside>
      </div>
      
      <!-- Article Footer -->
      <footer class="article-footer">
        <div class="article-share">
          <span>Share this article:</span>
          <div class="share-buttons">
            <a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.title)}&url=https://searchenginecoach.com/blog/${slug}/`} target="_blank" rel="noopener" class="share-btn">
              Twitter
            </a>
            <a href={`https://www.linkedin.com/shareArticle?mini=true&url=https://searchenginecoach.com/blog/${slug}/&title=${encodeURIComponent(post.title)}`} target="_blank" rel="noopener" class="share-btn">
              LinkedIn
            </a>
          </div>
        </div>
      </footer>
    </div>
  </article>
  
  <!-- CTA -->
  <CTASection 
    heading="Ready to Improve Your SEO?"
    subheading="Get your free SEO strategy and discover how to rank higher in your market."
    buttonText="Get Started"
  />
</BaseLayout>

<style>
  .blog-article {
    padding: var(--space-8) 0 var(--space-16);
  }
  
  .article-header {
    max-width: 800px;
    margin: 0 auto var(--space-8);
  }
  
  .breadcrumb {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-6);
  }
  
  .breadcrumb a {
    color: var(--color-text-muted);
  }
  
  .breadcrumb a:hover {
    color: var(--color-primary);
  }
  
  .article-meta-top {
    margin-bottom: var(--space-4);
  }
  
  .article-category {
    display: inline-block;
    padding: var(--space-1) var(--space-3);
    background: rgba(26, 86, 219, 0.1);
    color: var(--color-primary);
    font-size: var(--text-sm);
    font-weight: 500;
    border-radius: var(--radius-full);
  }
  
  .article-header h1 {
    font-size: var(--text-3xl);
    line-height: 1.2;
    margin-bottom: var(--space-4);
  }
  
  @media (min-width: 768px) {
    .article-header h1 {
      font-size: var(--text-4xl);
    }
  }
  
  .article-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2);
    color: var(--color-text-light);
    font-size: var(--text-sm);
  }
  
  .article-separator {
    color: var(--color-text-muted);
  }
  
  /* Featured Image */
  .article-image {
    max-width: 900px;
    margin: 0 auto var(--space-10);
    border-radius: var(--radius-xl);
    overflow: hidden;
  }
  
  .article-image img {
    width: 100%;
    height: auto;
    display: block;
  }
  
  /* Article Grid */
  .article-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-10);
    max-width: 1100px;
    margin: 0 auto;
  }
  
  @media (min-width: 1024px) {
    .article-grid {
      grid-template-columns: 1fr 300px;
    }
  }
  
  /* Prose Styling */
  .article-content.prose {
    max-width: none;
  }
  
  .article-content h2 {
    font-size: var(--text-2xl);
    margin-top: var(--space-10);
    margin-bottom: var(--space-4);
  }
  
  .article-content h3 {
    font-size: var(--text-xl);
    margin-top: var(--space-8);
    margin-bottom: var(--space-3);
  }
  
  .article-content p {
    line-height: 1.8;
    margin-bottom: var(--space-4);
  }
  
  .article-content ul,
  .article-content ol {
    margin-bottom: var(--space-4);
    padding-left: var(--space-6);
  }
  
  .article-content li {
    margin-bottom: var(--space-2);
    line-height: 1.7;
  }
  
  .article-content strong {
    font-weight: 600;
    color: var(--color-secondary);
  }
  
  .article-content pre {
    background: var(--color-bg-alt);
    padding: var(--space-4);
    border-radius: var(--radius-md);
    overflow-x: auto;
    margin-bottom: var(--space-4);
    font-size: var(--text-sm);
  }
  
  /* Sidebar */
  .article-sidebar {
    display: none;
  }
  
  @media (min-width: 1024px) {
    .article-sidebar {
      display: block;
    }
  }
  
  .sidebar-sticky {
    position: sticky;
    top: 100px;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }
  
  .sidebar-cta,
  .sidebar-related {
    background: white;
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
  }
  
  .sidebar-cta {
    background: linear-gradient(135deg, #f0f7ff 0%, #e0efff 100%);
    text-align: center;
  }
  
  .sidebar-cta h3 {
    font-size: var(--text-lg);
    margin-bottom: var(--space-2);
  }
  
  .sidebar-cta p {
    font-size: var(--text-sm);
    color: var(--color-text-light);
    margin-bottom: var(--space-4);
  }
  
  .sidebar-related h3 {
    font-size: var(--text-base);
    margin-bottom: var(--space-4);
  }
  
  .sidebar-related ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .sidebar-related li {
    margin-bottom: var(--space-3);
  }
  
  .sidebar-related a {
    font-size: var(--text-sm);
    color: var(--color-text);
    line-height: 1.4;
  }
  
  .sidebar-related a:hover {
    color: var(--color-primary);
  }
  
  /* Footer */
  .article-footer {
    max-width: 800px;
    margin: var(--space-10) auto 0;
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-border-light);
  }
  
  .article-share {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    flex-wrap: wrap;
  }
  
  .article-share span {
    font-size: var(--text-sm);
    color: var(--color-text-light);
  }
  
  .share-buttons {
    display: flex;
    gap: var(--space-2);
  }
  
  .share-btn {
    padding: var(--space-2) var(--space-4);
    background: var(--color-bg-alt);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
  }
  
  .share-btn:hover {
    background: var(--color-primary);
    color: white;
  }
</style>
